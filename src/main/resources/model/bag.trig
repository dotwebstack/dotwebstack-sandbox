@prefix bag: <http://bag.basisregistraties.nl#>.
@prefix bag_def: <http://bag.basisregistraties.overheid.nl/def/bag#>.
@prefix elmo: <http://dotwebstack.org/def/elmo#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.

bag:Backend a elmo:SparqlBackend;
  elmo:endpoint "https://data.pdok.nl/sparql"^^xsd:anyURI;
.

bag:Panden a elmo:InformationProduct;
  rdfs:label "BAG Panden";
  elmo:backend bag:Backend;
  elmo:query '''
    prefix bag_def: <http://bag.basisregistraties.overheid.nl/def/bag#>
    prefix bag_beg: <http://bag.basisregistraties.overheid.nl/id/begrip/>
    prefix geo: <http://www.opengis.net/ont/geosparql#>
    prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>

    select ?pand ?oorspronkelijkBouwjaar ?status ?wkt ?beginGeldigheid ?eindGeldigheid
    where {
      graph ?voorkomen {
        ?pand rdf:type bag_def:Pand;
          bag_def:oorspronkelijkBouwjaar ?oorspronkelijkBouwjaar;
          bag_def:status ?status;
          bag_def:geometriePand ?geometriePand;
          rdfs:isDefinedBy ?voorkomen;
        .
        ?geometriePand geo:asWKT ?wkt.
        ?voorkomen bag_def:beginGeldigheid ?beginGeldigheid;
          bag_def:aanduidingInactief ?aanduidingInactief;
        .
        optional {
          ?voorkomen bag_def:eindGeldigheid ?eindGeldigheid.
        }
        filter (
          ?aanduidingInactief = false
          && ?status = bag_beg:PandInGebruik
          && ?beginGeldigheid <= ?geldigOp
          && (!bound(?eindGeldigheid) || ?eindGeldigheid > ?geldigOp)
        )
        bind("2016-01-01T00:00:00.000Z"^^xsd:dateTime as ?geldigOp)
      }
    }
    limit 20
  ''';
.
