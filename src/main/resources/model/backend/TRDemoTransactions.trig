GRAPH dbeerpedia:Theatre {
	# Transaction: replace resource from graph
	dbeerpedia:InsertOrReplaceConcept a elmo:Transaction;
		elmo:conformsTo dbeerpedia:ConceptShapeGraph;
		elmo:preQueries (
			[
				a elmo:Query;
				rdfs:label "Add missing labels";
				elmo:query """
					insert {
						?concept rdfs:label ?label
					}
					where {
						?concept skos:prefLabel ?label.
						FILTER NOT EXISTS {
							?concept rdfs:label ?existinglabel
						}
					}
				""";
			]
		);
#		elmo:storageProtocol elmo-sp:InsertOrReplaceResourceInGraph;
		elmo:targetGraph <http://dotwebstack.org/all-concepts>;
		elmo:postQueries (
			[
				a elmo:Query;
				rdfs:label "Add hash";
				elmo:query """
					insert {
						graph <http://dotwebstack.org/all-concepts> {
							?concept wdrs:hash ?hash
						}
					}
					where {
						graph <http://dotwebstack.org/all-concepts> {
							select (md5(?definition) as ?hash) {
								?concept skos:definition ?definition
							}
						}
					}
				"""
			]
		)
	.
	dbeerpedia:DeleteConcept a elmo:Transaction;
#		elmo:storageProtocol elmo-sp:DeleteResourceFromGraph;
		elmo:targetGraph <http://dotwebstack.org/all-concepts>;
	.
	dbeerpedia:Transform a elmo:Transaction;
		elmo:transformer [
			a elmo:RMLTransformer;
			elmo:sourceGraph dbeerpedia:RMLMap;
		];
#		elmo:storageProtocol elmo-sp:ReplaceGraph;
		elmo:targetGraph <http://dotwebstack.org/uploaded-data>
	.
}